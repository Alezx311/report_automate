# Report Automate

Автоматизована система звітності для Outlook emails та Jira задач.

![Version](https://img.shields.io/badge/version-2.0.0-blue.svg)
![Node](https://img.shields.io/badge/node-%3E%3D18.0.0-green.svg)
![License](https://img.shields.io/badge/license-MIT-green.svg)

## Можливості

**Джерела даних:**

- Парсинг PST файлів (експорт з Outlook)
- Парсинг JSON файлів (експортовані через скрипт)
- IMAP підключення (пряме підключення до Outlook/Exchange)
- Microsoft Graph API (корпоративні акаунти Microsoft 365)
- Jira інтеграція (завантаження та створення задач)

**Обробка та аналіз:**

- Автоматичне групування листів в треди
- Визначення статусів звернень (Вирішено/У процесі/Не закрито)
- Розпізнавання систем за ключовими словами
- Визначення важливості звернень
- Побудова детальної історії переписки
- Фільтрація та сортування результатів

**Експорт та звітність:**

- Експорт в CSV для Excel
- Експорт в Jira (масове створення задач)
- Детальна статистика (кількість звернень, середня кількість листів)
- Вибір папок (INBOX, Sent Items, Archive)
- Фільтрація по датах

**Робота з великими файлами:**

- Підтримка PST файлів до 2GB
- Експорт PST в JSON для обходу обмежень Node.js
- Інструкції для ручного розділення файлів в Outlook
- Обробка файлів частинами

## Вимоги

- Node.js 18 або новіший ([завантажити](https://nodejs.org/))
- npm (встановлюється з Node.js)
- Windows/macOS/Linux

## Швидкий старт

### 1. Встановлення

```bash
# Клонуйте або розпакуйте проект
cd report-automate

# Встановіть залежності
npm install
```

### 2. Налаштування

```bash
# Створіть .env файл
cp .env.example .env
```

Відредагуйте `.env` з вашими параметрами:

```env
# Outlook
OUTLOOK_IMAP_USER=your-email@company.com
OUTLOOK_IMAP_PASSWORD=your-app-password

# Jira
JIRA_HOST=https://your-company.atlassian.net
JIRA_EMAIL=your-email@company.com
JIRA_API_TOKEN=your-api-token
JIRA_PROJECT_KEY=SUPPORT

# Техпідтримка
SUPPORT_EMAILS=support@company.com,admin@company.com
```

### 3. Запуск

```bash
# Звичайний режим
npm start

# З консоллю (для дебагу)
npm run dev
```

### 4. Збірка виконуваного файлу

```bash
npm run build
```

Готова програма буде в папці `dist/`

## Інструкція використання

### Варіант 1: PST Файл

1. Експортуйте папку з Outlook: File → Open & Export → Import/Export → Export to a file → Outlook Data File (.pst)
2. У програмі натисніть "PST Файл"
3. Натисніть "Вибрати файл" та оберіть PST або JSON
4. (Опціонально) Встановіть діапазон дат
5. Натисніть "Парсити PST"
6. Дочекайтеся завершення обробки
7. Перегляньте результати
8. Експортуйте в CSV або Jira

**Обмеження:** PST файл не повинен перевищувати 2GB через обмеження Node.js

**Для файлів >2GB:**

- Використайте скрипт `_dev/export_pst_to_json.js` для конвертації в JSON (якщо файл <2GB)
- Або розділіть файл вручну в Outlook по місяцях/тижнях
- Детальніше: [LARGE_PST_GUIDE.md](./LARGE_PST_GUIDE.md)

### Варіант 2: Outlook IMAP

1. Натисніть "Outlook IMAP"
2. Введіть ваш email
3. Введіть App Password (не звичайний пароль!)
4. Натисніть "Підключитись"
5. Оберіть папку з випадаючого списку:
   - `INBOX` - вхідні
   - `Sent Items` - відправлені
   - `Archive` - архів
   - та інші доступні папки
6. Встановіть діапазон дат
7. Натисніть "Завантажити листи"
8. Експортуйте результати

**Примітка:** Перше підключення може тривати довше

### Варіант 3: Jira

1. Натисніть "Jira"
2. Введіть URL Jira (наприклад: `https://company.atlassian.net`)
3. Введіть ваш email
4. Введіть API Token
5. Введіть Project Key (наприклад: `SUPPORT`)
6. Натисніть "Підключитись"
7. Встановіть діапазон дат
8. Натисніть "Завантажити задачі"

Система завантажить задачі зі статусами:

- **Assigned** - початок звернення
- **In Progress** - звернення в роботі
- **Completed** - звернення закрито

### Експорт результатів

**CSV:**

1. Після отримання результатів натисніть "Експорт CSV"
2. Файл буде збережено в папці `output/`
3. Відкрийте в Excel для редагування

**Jira:**

1. Виберіть звернення (checkbox ліворуч)
2. Натисніть "Експорт в Jira"
3. Підтвердіть створення
4. Спостерігайте за прогресом
5. Після завершення отримаєте звіт

## Логіка роботи

### Email (PST/IMAP)

1. **Групування** - листи об'єднуються в треди (по conversation ID або темі)
2. **Перший лист клієнта** - початок нового звернення
3. **Наступні листи клієнта** - додаються до опису
4. **Відповідь техпідтримки** - створює окремий запис звернення
5. **Наступне звернення клієнта** - нове звернення в тому ж треді

**Важливо:** Кожна відповідь техпідтримки = окремий запис в звіті

### Jira

1. **Assigned** - дата реєстрації звернення
2. **In Progress** - звернення в роботі
3. **Completed** - дата закриття звернення
4. Враховується історія всіх переходів

### Статуси

- **Вирішено** - є відповідь техпідтримки + підтвердження клієнта ("дякую", "працює")
- **Вирішено частково** - є відповідь, немає підтвердження
- **У процесі** - активне звернення, немає відповіді
- **Не закрито** - застарілі звернення без відповіді

### Важливість

- **Високий** - "прод", "prod", "терміново", "критично", "urgent", "critical"
- **Середній** - звичайні звернення
- **Низький** - "тест", "test", "аналіз"

### Розпізнавання систем

Автоматично визначається за ключовими словами в темі або тілі листа:

- ESB - Enterprise Service Bus
- FICO - SAP FICO
- IPS - Internet Payment System
- PVBKI, FBCH, STRABIS - кредитні бюро
- EDR - Єдиний державний реєстр
- та інші (повний список в `config/systems.json`)

## Формат CSV звіту

| Колонка           | Опис                                    |
| ----------------- | --------------------------------------- |
| Дата реєстрації   | Коли почалось звернення                 |
| Час реєстрації    | Точний час                              |
| Система           | ESB, IPS, FICO, тощо                    |
| Кількість листів  | Скільки повідомлень в зверненні         |
| Тема              | Тема листа/задачі                       |
| Запит             | Короткий опис проблеми (перші 300 симв) |
| Відповідь         | Рішення від техпідтримки (300 симв)     |
| Історія переписки | Повна історія треду                     |
| Статус            | Вирішено/У процесі/Не закрито           |
| Відповідальний    | Хто вирішив                             |
| Дата вирішення    | Коли вирішено                           |
| Час вирішення     | Точний час                              |
| Важливість        | Високий/Середній/Низький                |
| Тип проблеми      | Категорія звернення                     |
| Conversation ID   | Ідентифікатор треду                     |
| Jira Key          | Ключ задачі (якщо з Jira)               |
| Джерело           | Email або Jira                          |

## Структура проекту

```
report_automate/
├── _dev/                        # Допоміжні скрипти
│   ├── export_pst_to_json.js    # Експорт PST в JSON (<2GB)
│   ├── split_pst_by_date.js     # Розділення PST (не працює >2GB)
│   ├── process_chunks.js        # Обробка множини JSON файлів
│   ├── diagnose_imap.js         # Діагностика IMAP підключення
│   └── test_graph_api.js        # Тест Graph API
├── config/
│   └── systems.json             # Список систем та ключових слів
├── src/
│   ├── parsers/
│   │   ├── pstParser.js         # Парсинг PST файлів
│   │   └── imapParser.js        # IMAP клієнт
│   ├── integrations/
│   │   └── jiraClient.js        # Jira API клієнт
│   └── processors/
│       └── reportGenerator.js   # Генерація звітів та обробка
├── ui/
│   ├── index.html               # Інтерфейс
│   ├── styles.css               # Стилі
│   └── renderer.js              # UI логіка
├── output/                      # Згенеровані CSV файли
├── main.js                      # Головний файл Electron
├── preload.js                   # IPC bridge
├── package.json                 # Конфігурація проекту
├── .env                         # Налаштування (не в Git!)
├── .env.example                 # Приклад налаштувань
├── .gitignore                   # Список ігнорованих файлів
├── README.md                    # Ця документація
├── IMAP_SETUP.md                # Інструкції підключення IMAP
├── LARGE_PST_GUIDE.md           # Робота з великими PST файлами
├── SPLIT_IN_OUTLOOK.md          # Як розділити PST в Outlook
└── QUICK_START.md               # Швидкий старт
```

## Безпека

**ВАЖЛИВО:**

- Файл `.env` вже в `.gitignore`
- Використовуйте App Password для Outlook, НЕ основний пароль
- Jira API токени мають обмежений термін дії
- Не публікуйте `.env` файл ніде
- Регулярно оновлюйте токени та паролі

## Вирішення проблем

### IMAP не підключається

**Перевірте:**

1. Чи увімкнено IMAP в налаштуваннях Outlook?
2. Використовуєте App Password, а не основний?
3. Правильні host (`outlook.office365.com`) та port (`993`)?
4. Чи потрібен VPN для доступу до корпоративної мережі?

**Як увімкнути IMAP:**

1. Outlook.com → Settings → View all Outlook settings
2. Mail → Sync email
3. Увімкніть "Let devices and apps use IMAP"

### Jira помилка підключення

**Перевірте:**

1. API токен дійсний і не застарілий?
2. Правильний Project Key?
3. Є права на створення задач у проекті?
4. URL правильний? (з `https://`)

### Не знайдено листів

**Перевірте:**

1. Правильні дати?
2. Є листи в обраній папці?
3. Email техпідтримки правильно вказані в `config/systems.json`?
4. Фільтри не занадто обмежувальні?

### Повільна робота

**Порада:**

- Зменшіть діапазон дат
- Оберіть конкретну папку замість кореневої
- Для PST >1GB спочатку експортуйте в JSON або розділіть файл в Outlook

### Пошкоджений текст в результатах

Якщо бачите пошкоджені символи в колонках "Запит", "Відповідь" або "Історія переписки":

- Це означає що PST файл містить пошкоджене кодування
- Система автоматично очищає більшість garbage
- Якщо проблема залишається - експортуйте пошту заново з Outlook

## Підтримка

**При виникненні проблем:**

1. Натисніть `F12` → перевірте Console на помилки
2. Прочитайте [IMAP_SETUP.md](./IMAP_SETUP.md)
3. Перевірте правильність `.env` файлу
4. Спробуйте тестове підключення з невеликою кількістю даних

## Оновлення

```bash
# Оновити залежності
npm update

# Повне перевстановлення
rm -rf node_modules
npm install
```

## Changelog

### v2.0.0 (2025)

- Перший повноцінний реліз
- Парсинг PST файлів з обробкою всіх повідомлень
- Підтримка JSON файлів (експортованих через скрипт)
- IMAP підключення з вибором папок
- Jira інтеграція (завантаження та створення)
- Підтримка статусів Assigned/In Progress/Completed
- Детальна статистика
- Експорт в CSV
- Графічний інтерфейс з сортуванням та фільтрацією
- Фільтрація по датах
- Логіка: кожна відповідь техпідтримки = окремий запис
- Очищення тексту від HTML, VML, пошкодженого Unicode
- Інструкції для роботи з великими файлами (>2GB)

## Ліцензія

MIT License - вільне використання та модифікація

---

**Version:** 2.0.0
**Created:** 2025

Успішної автоматизації звітності!

---

## Корисні посилання

- [Документація Outlook IMAP](https://support.microsoft.com/en-us/office/pop-imap-and-smtp-settings-8361e398-8af4-4e97-b147-6c6c4ac95353)
- [Jira REST API](https://developer.atlassian.com/cloud/jira/platform/rest/v2/)
- [Electron Documentation](https://www.electronjs.org/docs)
- [Node.js Download](https://nodejs.org/)

---

**Примітка:** Для деталей підключення до Outlook та Jira дивіться [IMAP_SETUP.md](./IMAP_SETUP.md)
